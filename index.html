<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Excel 表格合并（类似数据库 JOIN）</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="app-header">
    <h1>Excel/CSV 表格合并</h1>
    <div class="header-actions">
      <button id="resetApp" class="btn ghost" title="重置页面">重置</button>
      <a class="btn link" href="https://github.com/" target="_blank" rel="noreferrer">GitHub</a>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>📂 1. 上传数据文件</h2>
      <div class="upload-grid">
        <div>
          <label class="label">左表文件 (A)</label>
          <div id="dropzoneA" class="dropzone">
            <div class="dropzone-content">
              <span class="dropzone-icon">📄</span>
              <span class="dropzone-text">拖拽文件到此处或点击选择</span>
            </div>
            <input id="fileA" type="file" accept=".xlsx,.xls,.csv" />
          </div>
          <div class="file-info" id="fileInfoA"></div>
          <div class="row small">
            <label>工作表：</label>
            <select id="sheetA"></select>
          </div>
          <button id="previewA" class="btn small" style="margin-top: 8px;">预览左表</button>
        </div>
        <div>
          <label class="label">右表文件 (B)</label>
          <div id="dropzoneB" class="dropzone">
            <div class="dropzone-content">
              <span class="dropzone-icon">📄</span>
              <span class="dropzone-text">拖拽文件到此处或点击选择</span>
            </div>
            <input id="fileB" type="file" accept=".xlsx,.xls,.csv" />
          </div>
          <div class="file-info" id="fileInfoB"></div>
          <div class="row small">
            <label>工作表：</label>
            <select id="sheetB"></select>
          </div>
          <button id="previewB" class="btn small" style="margin-top: 8px;">预览右表</button>
        </div>
      </div>
      <div class="row small">
        <label><input id="hasHeader" type="checkbox" checked /> 首行作为表头</label>
      </div>
    </section>

    <section class="card">
      <h2>🔗 2. 选择合并键与类型</h2>
      <div class="grid-2">
        <div>
          <label class="label">左表键列</label>
          <div id="keysA" class="chips"></div>
        </div>
        <div>
          <label class="label">右表键列</label>
          <div id="keysB" class="chips"></div>
        </div>
      </div>
      <div class="row">
        <label class="label">Join 类型</label>
        <select id="joinType">
          <option value="inner">INNER JOIN（交集）</option>
          <option value="left">LEFT JOIN（左表全部）</option>
          <option value="right">RIGHT JOIN（右表全部）</option>
          <option value="full">FULL OUTER JOIN（并集）</option>
        </select>
        <label class="label">空白/缺失填充值</label>
        <input id="nullFill" type="text" placeholder="例如：NULL" value="" />
      </div>
      <div class="row">
        <button id="runJoin" class="btn primary">✨ 执行合并</button>
        <button id="saveHistory" class="btn ghost">💾 保存到历史</button>
      </div>
    </section>

    <section class="card">
      <h2>📊 3. 数据预览与统计</h2>
      <div id="dataStats" class="data-stats-grid"></div>
    </section>

    <section class="card">
      <h2>📋 4. 结果预览与导出</h2>
      <div class="row small">
        <div id="stats" class="stats"></div>
        <div style="margin-left: auto; display: flex; gap: 8px;">
          <input id="searchTable" type="text" placeholder="🔍 搜索表格..." style="width: 200px;" />
          <button id="clearFilter" class="btn ghost small">清除</button>
        </div>
      </div>
      <div class="table-wrap">
        <table id="preview"></table>
      </div>
      <div class="row">
        <button id="exportCSV" class="btn">📥 导出 CSV</button>
        <button id="exportXLSX" class="btn">📥 导出 XLSX</button>
        <button id="exportJSON" class="btn">📥 导出 JSON</button>
      </div>
    </section>

    <section class="card" id="historySection" style="display: none;">
      <h2>🕒 历史记录</h2>
      <div id="historyList" class="history-list"></div>
    </section>
  </main>

  <footer class="footer">
    <span>本地浏览器完成解析与合并，不上传任何数据。</span>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="script.js"></script>
</body>
</html>

